<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cellular Relationships in the Rat Alveolus • NICHES</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cellular Relationships in the Rat Alveolus">
<meta property="og:description" content="NICHES">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NICHES</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01%20NICHES%20Spatial.html">Estimating Microenvironment from Spatial Data</a>
    </li>
    <li>
      <a href="../articles/02%20NICHES%20Single.html">Converting Single-Cell Atlases to Single-Cell Signaling Atlases</a>
    </li>
    <li>
      <a href="../articles/03%20Rat%20Alveolus.html">Cellular Relationships in the Rat Alveolus</a>
    </li>
    <li>
      <a href="../articles/04%20Differential%20CellToCell.html">Differential CellToCell Signaling Across Conditions</a>
    </li>
    <li>
      <a href="../articles/05%20Differential%20SystemToCell.html">Differential SystemToCell Signaling Across Conditions</a>
    </li>
    <li>
      <a href="../articles/06%20Pseudotime.html">Pseudotemporal Ordering with NICHES</a>
    </li>
    <li>
      <a href="../articles/07%20Spatiotemporal%20NICHES.html">Spatio-Temporal NICHES</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cellular Relationships in the Rat Alveolus</h1>
                        <h4 class="author">Micha Sam Brickman Raredon &amp; Junchen Yang</h4>
            
            <h4 class="date">2022-06-20</h4>
      
      
      <div class="hidden name"><code>03 Rat Alveolus.Rmd</code></div>

    </div>

    
    
<p>In this vignette we explore cellular microenvironment, cellular influence, and specific cell-cell relationships in the rat alveolus leveraging data from <a href="https://www.science.org/doi/10.1126/sciadv.aaw3851" class="uri">https://www.science.org/doi/10.1126/sciadv.aaw3851</a></p>
<div id="load-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">SeuratWrappers</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://msraredon.github.io/NICHES/">NICHES</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.satijalab.org/seurat">SeuratData</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Connectome</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">TSCAN</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl">writexl</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></code></pre></div>
<p>First, let’s take a look at the whole dataset (10,953 cells):</p>
<p>#Load Data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"raredon_2019_rat.Robj"</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">TSNEPlot</a></span><span class="op">(</span><span class="va">rat</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>It is important to note that not all of these cell types are localized close together in the same region of tissue. Let’s limit our analysis to 9 celltypes that we are confident co-localize within the same region of tissue, namely, the alveolus:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">rat</span>,idents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ATII'</span>,<span class="st">'ATI'</span>,
                                 <span class="st">'Mac_alv'</span>,<span class="st">'Mac_inter'</span>,
                                 <span class="st">'Fib_Col13a1+'</span>,<span class="st">'Fib_Col14a1+'</span>,<span class="st">'SMCs'</span>,
                                 <span class="st">'EC_cap'</span>,<span class="st">'EC_vasc'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We may then compute and explore the character of different cellular ‘niches’ (System-to-Cell signaling networks) within this specific cell-system, as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lung.niche</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunNICHES.html">RunNICHES</a></span><span class="op">(</span><span class="va">rat.sub</span>,
                        assay <span class="op">=</span> <span class="st">'alra'</span>,
                        species <span class="op">=</span> <span class="st">'rat'</span>,
                        LR.database <span class="op">=</span> <span class="st">'fantom5'</span>,
                        SystemToCell <span class="op">=</span> <span class="cn">T</span>,
                        CellToCell <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> 
<span class="co"># Here we use a previously-created imputed data slot. The same computation may be performed on any data slot including standard log-normalized RNA values.</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="va">lung.niche</span><span class="op">$</span><span class="va">SystemToCell</span> <span class="co">#Extract the output of interest</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="co">#Scale</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="co">#Identify variable features</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">niche.object</span>,npcs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co">#RunPCA</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">niche.object</span>,ndims<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="co">#Choose PCs to use for embedding</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">niche.object</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span> <span class="co">#Embed</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">niche.object</span>,reduction <span class="op">=</span> <span class="st">'umap'</span>,label <span class="op">=</span> <span class="cn">T</span>,repel <span class="op">=</span> <span class="cn">F</span>,label.size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoLegend</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoAxes</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Alveolar Microenvironment'</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>Each dot in the plot above represents an individual System-to-Cell network landing on a given receiving cell within this alveolar cell-system. We may identify markers for each celltype or cluster as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Markers</span>
<span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">niche.object</span><span class="op">[[</span><span class="st">'ReceivingType'</span><span class="op">]</span><span class="op">]</span>
<span class="va">mark</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html">FindAllMarkers</a></span><span class="op">(</span><span class="va">niche.object</span>,logfc.threshold <span class="op">=</span> <span class="fl">1</span>,min.pct <span class="op">=</span> <span class="fl">0.5</span>,only.pos <span class="op">=</span> <span class="cn">T</span>,test.use <span class="op">=</span> <span class="st">'roc'</span><span class="op">)</span>

<span class="co"># Pull markers of interest to plot</span>
<span class="va">mark</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">mark</span><span class="op">$</span><span class="va">pct.1</span><span class="op">/</span><span class="va">mark</span><span class="op">$</span><span class="va">pct.2</span>
<span class="va">marker.list</span> <span class="op">&lt;-</span> <span class="va">mark</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">5</span>,<span class="va">avg_log2FC</span><span class="op">)</span>

<span class="co">#Plot in Heatmap form</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DoHeatmap.html">DoHeatmap</a></span><span class="op">(</span><span class="va">niche.object</span>,features <span class="op">=</span> <span class="va">marker.list</span><span class="op">$</span><span class="va">gene</span>,cells <span class="op">=</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/WhichCells.html">WhichCells</a></span><span class="op">(</span><span class="va">niche.object</span>,downsample <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>This gives us a sense of the character of each celltype niche. However, it doesn’t allow us to see where the signal is coming from. To ask these kinds of questions, we need to characterize cell-cell relationships, which we do as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lung.cc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunNICHES.html">RunNICHES</a></span><span class="op">(</span><span class="va">rat.sub</span>,
                        assay <span class="op">=</span> <span class="st">'alra'</span>,
                        species <span class="op">=</span> <span class="st">'rat'</span>,
                        LR.database <span class="op">=</span> <span class="st">'fantom5'</span>,
                        CellToCell <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="co">#Note the difference in input arguments here</span>
<span class="va">cc.object</span> <span class="op">&lt;-</span> <span class="va">lung.cc</span><span class="op">$</span><span class="va">CellToCell</span> <span class="co">#Extract the output of interest</span>
<span class="va">cc.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">cc.object</span><span class="op">)</span> <span class="co">#Scale</span>
<span class="va">cc.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">cc.object</span><span class="op">)</span> <span class="co">#Identify variable features</span>
<span class="va">cc.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">cc.object</span>,npcs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co">#RunPCA</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">cc.object</span>,ndims<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="co">#Choose PCs to use for embedding</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-6-1.png" width="1152"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cc.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">cc.object</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="co">#Embed</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">cc.object</span>,reduction <span class="op">=</span> <span class="st">'umap'</span>,label <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoAxes</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Alveolar Cell-Cell Signaling'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">2</span>,override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#Plot</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-6-2.png" width="1152"></p>
<p>We are now prepared to fully dissect a given cellular niche. Let’s see how different cells influence the EC_cap population within this system:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">cc.object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cc.object</span><span class="op">[[</span><span class="st">'ReceivingType'</span><span class="op">]</span><span class="op">]</span>
<span class="va">ec.network</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">cc.object</span>,idents <span class="op">=</span><span class="st">'EC_cap'</span><span class="op">)</span>
<span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">ec.network</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ec.network</span><span class="op">[[</span><span class="st">'VectorType'</span><span class="op">]</span><span class="op">]</span>
<span class="va">mark.ec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html">FindAllMarkers</a></span><span class="op">(</span><span class="va">ec.network</span>,
                          logfc.threshold <span class="op">=</span> <span class="fl">1</span>,
                          min.pct <span class="op">=</span> <span class="fl">0.5</span>,
                          only.pos <span class="op">=</span> <span class="cn">T</span>,
                          test.use <span class="op">=</span> <span class="st">'roc'</span><span class="op">)</span>
<span class="co"># Pull markers of interest to plot</span>
<span class="va">mark.ec</span><span class="op">$</span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="va">mark.ec</span><span class="op">$</span><span class="va">pct.1</span><span class="op">/</span><span class="va">mark.ec</span><span class="op">$</span><span class="va">pct.2</span>
<span class="va">marker.list.ec</span> <span class="op">&lt;-</span> <span class="va">mark.ec</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span><span class="fl">5</span>,<span class="va">avg_log2FC</span><span class="op">)</span>

<span class="co">#Plot in Heatmap form</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DoHeatmap.html">DoHeatmap</a></span><span class="op">(</span><span class="va">ec.network</span>,features <span class="op">=</span> <span class="va">marker.list.ec</span><span class="op">$</span><span class="va">gene</span>,cells <span class="op">=</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/WhichCells.html">WhichCells</a></span><span class="op">(</span><span class="va">ec.network</span>,downsample <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
<p>One of the powerful applications of NICHES is the ability to parse intra-cluster heterogeneity very easily, to see if there are subtly-different subcategories of cell-cell relationships present within the data. Here, we further dissect cell-cell signaling coming from alveolar macrophages and landing on the ATI cell population:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subclustering of a relationship:</span>
<span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">cc.object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cc.object</span><span class="op">[[</span><span class="st">'VectorType'</span><span class="op">]</span><span class="op">]</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">cc.object</span>,idents <span class="op">=</span> <span class="st">'Mac_alv—ATI'</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">sub</span>,ndims<span class="op">=</span><span class="fl">50</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/DimHeatmap.html">PCHeatmap</a></span><span class="op">(</span><span class="va">sub</span>,dims<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,balanced <span class="op">=</span> <span class="cn">T</span>,cells<span class="op">=</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">sub</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html">FindNeighbors</a></span><span class="op">(</span><span class="va">sub</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,force.recalc <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html">FindClusters</a></span><span class="op">(</span><span class="va">sub</span>,resolution <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="co">#&gt; Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of nodes: 1331</span>
<span class="co">#&gt; Number of edges: 40995</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Running Louvain algorithm...</span>
<span class="co">#&gt; Maximum modularity in 10 random starts: 0.9292</span>
<span class="co">#&gt; Number of communities: 5</span>
<span class="co">#&gt; Elapsed time: 0 seconds</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<p>This looks interesting. Let’s explore some marker mechanisms:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mark.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html">FindAllMarkers</a></span><span class="op">(</span><span class="va">sub</span>,only.pos <span class="op">=</span> <span class="cn">T</span>,test.use <span class="op">=</span> <span class="st">'roc'</span><span class="op">)</span>
<span class="va">marker.sub.list</span> <span class="op">&lt;-</span> <span class="va">mark.sub</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="co">#%&gt;% top_n(20,avg_log2FC)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DoHeatmap.html">DoHeatmap</a></span><span class="op">(</span><span class="va">sub</span>,features <span class="op">=</span> <span class="va">marker.sub.list</span><span class="op">$</span><span class="va">gene</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"white"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="03%20Rat%20Alveolus_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>All of these measurements are from the pairing of an alveolar macrophage as a sending cell and an ATI cell as a receiving cell. However, within this single cell-cell relationship, there are subcategories of cell pairings which are possible. Above, it is notable that cluster 1 is quite sparse in mechanism employment. Additionally, cluster 4 is employing a number of signaling mechanisms which are largely not used by the other subcategories of macrophage-ATI pairings.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Micha Sam Brickman Raredon, Junchen Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
