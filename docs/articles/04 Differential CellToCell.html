<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using NICHES to Analyze Cell-Cell Signaling Across Conditions • NICHES</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using NICHES to Analyze Cell-Cell Signaling Across Conditions">
<meta property="og:description" content="NICHES">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NICHES</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01%20NICHES%20Spatial.html">Estimating Microenvironment from Spatial Data</a>
    </li>
    <li>
      <a href="../articles/02%20NICHES%20Single.html">Converting Single-Cell Atlases to Single-Cell Signaling Atlases</a>
    </li>
    <li>
      <a href="../articles/03%20Rat%20Alveolus.html">Cellular Relationships in the Rat Alveolus</a>
    </li>
    <li>
      <a href="../articles/04%20Differential%20CellToCell.html">Using NICHES to Analyze Cell-Cell Signaling Across Conditions</a>
    </li>
    <li>
      <a href="../articles/05%20Differential%20SystemToCell.html">Differential SystemToCell Signaling Across Conditions</a>
    </li>
    <li>
      <a href="../articles/06%20Pseudotime.html">Pseudotemporal Ordering with NICHES</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using NICHES to Analyze Cell-Cell Signaling Across Conditions</h1>
                        <h4 class="author">Wes Lewis &amp; Micha Sam Brickman Raredon</h4>
            
            <h4 class="date">2022-06-19</h4>
      
      
      <div class="hidden name"><code>04 Differential CellToCell.Rmd</code></div>

    </div>

    
    
<p>A common question is how to use NICHES to assess differential signaling across experimental conditions or batches. This is a task that is exceptionally easy in NICHES if performed in the correct way. Here, we demonstrate how to approach this task, using the publicly available ‘ifnb’ dataset within SeuratData which allows comparision of IFNb-stimualted PBMCs versus control PBMCs.</p>
<div id="load-required-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-required-packages" class="anchor"></a>Load Required Packages</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://msraredon.github.io/NICHES/">NICHES</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="load-data-and-explore-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data-and-explore-metadata" class="anchor"></a>Load Data and Explore Metadata</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.satijalab.org/seurat">SeuratData</a></span><span class="op">)</span>
<span class="co">#InstallData("ifnb")</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"ifnb"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ifnb</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">stim</span>,<span class="va">ifnb</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">seurat_annotations</span><span class="op">)</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt;        CD14 Mono CD4 Naive T CD4 Memory T CD16 Mono    B CD8 T T activated   NK</span>
<span class="co">#&gt;   CTRL      2215         978          859       507  407   352         300  298</span>
<span class="co">#&gt;   STIM      2147        1526          903       537  571   462         333  321</span>
<span class="co">#&gt;       </span>
<span class="co">#&gt;          DC B Activated   Mk  pDC Eryth</span>
<span class="co">#&gt;   CTRL  258         185  115   51    23</span>
<span class="co">#&gt;   STIM  214         203  121   81    32</span></code></pre></div>
<p>This dataset contains two experimental conditions, annotated STIM and CTRL. Prior to running NICHES, we will split the dataset into two objects, one representing each experimental condition. This way, cells will only be crossed with cells in the same experimental condition.</p>
</div>
<div id="split-by-experimental-contion" class="section level2">
<h2 class="hasAnchor">
<a href="#split-by-experimental-contion" class="anchor"></a>Split by Experimental Contion</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set idents so that celltypes are in active identity slot</span>
<span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">ifnb</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ifnb</span><span class="op">@</span><span class="va">meta.data</span><span class="op">[</span><span class="st">"seurat_annotations"</span><span class="op">]</span>
<span class="co"># Split object into STIM and CTRL conditions, to calculate NICHES objects separately</span>
<span class="va">data.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SplitObject.html">SplitObject</a></span><span class="op">(</span><span class="va">ifnb</span>, split.by<span class="op">=</span><span class="st">"stim"</span><span class="op">)</span>
<span class="co"># Make sure that data is normalized</span>
<span class="va">data.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data.list</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html">NormalizeData</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>We now are prepared to run NICHES separately on the cell systems present in each experimental condition.</p>
</div>
<div id="run-niches" class="section level2">
<h2 class="hasAnchor">
<a href="#run-niches" class="anchor"></a>Run NICHES</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Run NICHES on each system and store/name the outputs</span>
<span class="va">scc.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">data.list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
  <span class="va">scc.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunNICHES.html">RunNICHES</a></span><span class="op">(</span><span class="va">data.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,
                             LR.database<span class="op">=</span><span class="st">"fantom5"</span>,
                             species<span class="op">=</span><span class="st">"human"</span>,
                             assay<span class="op">=</span><span class="st">"RNA"</span>,
                             min.cells.per.ident<span class="op">=</span><span class="fl">1</span>,
                             min.cells.per.gene <span class="op">=</span> <span class="fl">50</span>,
                             meta.data.to.map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'orig.ident'</span>,<span class="st">'seurat_annotations'</span>,<span class="st">'stim'</span><span class="op">)</span>,
                             SystemToCell <span class="op">=</span> <span class="cn">T</span>,
                             CellToCell <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; [1] 2</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">scc.list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data.list</span><span class="op">)</span></code></pre></div>
<p>NICHES provides output as a list of objects or tables, because it is capable of providing many different styles of output with a single run. Let’s isolate a specific output style we are interested in and tag it with appropriate metadata (redundant here, but good practice)</p>
</div>
<div id="isolate-output-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#isolate-output-of-interest" class="anchor"></a>Isolate Output of Interest</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">scc.list</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="va">temp.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">scc.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CellToCell</span> <span class="co"># Isolate CellToCell Signaling, which is all that will be covered in this vignette</span>
<span class="va">temp.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">scc.list</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="co"># Tag with metadata</span>
<span class="op">}</span></code></pre></div>
<p>We can then merge these NICHES outputs together to embed, cluster, and analyze them jointly:</p>
</div>
<div id="merge-and-clean" class="section level1">
<h1 class="hasAnchor">
<a href="#merge-and-clean" class="anchor"></a>Merge and Clean</h1>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Merge together</span>
<span class="va">scc.merge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">temp.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">temp.list</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Clean up low-information crosses (connectivity data can be very sparse)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/VlnPlot.html">VlnPlot</a></span><span class="op">(</span><span class="va">scc.merge</span>,features <span class="op">=</span> <span class="st">'nFeature_CellToCell'</span>,group.by <span class="op">=</span> <span class="st">'Condition'</span>,pt.size<span class="op">=</span><span class="fl">0.1</span>,log <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scc.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">scc.merge</span>,<span class="va">nFeature_CellToCell</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># Requesting at least 5 distinct ligand-receptor interactions between two cells</span></code></pre></div>
<p>Let’s now perform an initial visualization of signaling between these two conditions, which we do as follows:</p>
<div id="visualize-full-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize-full-dataset" class="anchor"></a>Visualize full dataset</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Perform initial visualization</span>
<span class="va">scc.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">scc.sub</span><span class="op">)</span>
<span class="va">scc.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">scc.sub</span><span class="op">)</span>
<span class="va">scc.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">scc.sub</span>,npcs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">scc.sub</span>,ndim<span class="op">=</span><span class="fl">50</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We choose to use the first 25 principle components for a first embedding:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scc.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">scc.sub</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">scc.sub</span>,group.by <span class="op">=</span> <span class="st">'VectorType'</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoLegend</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">scc.sub</span>,group.by <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">scc.sub</span>,group.by <span class="op">=</span> <span class="st">'ReceivingType'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-8-3.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">scc.sub</span>,group.by <span class="op">=</span> <span class="st">'SendingType'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
<p>One thing we can do at this point is to ask how signaling is different between conditions for an individual cell-to-cell VectorType, which we do as follows:</p>
</div>
<div id="focus-on-a-single-cell-cell-cross-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#focus-on-a-single-cell-cell-cross-of-interest" class="anchor"></a>Focus on a single cell-cell cross of interest</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">scc.sub</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">VectorType</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "CD14 Mono—CD14 Mono"    "CD14 Mono—CD4 Naive T"  "CD14 Mono—CD4 Memory T"</span>
<span class="co">#&gt; [4] "CD14 Mono—CD16 Mono"    "CD14 Mono—B"            "CD14 Mono—CD8 T"</span>
<span class="co"># Define VectorTypes of interest (note the long em-dash used in NICHES)</span>
<span class="va">VOI</span> <span class="op">&lt;-</span> <span class="st">"CD14 Mono—DC"</span>
<span class="co"># Loop over VectorTypes of interest, subsetting those interactions, finding markers associated with the comparison of interest (stimulus vs control) and  create a heatmap of top markers:</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">VOI</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
 
  <span class="co">#subset</span>
  <span class="va">subs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">scc.sub</span>, subset <span class="op">=</span> <span class="va">VectorType</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span>
  
  <span class="co">#print number of cells per condition</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span> , <span class="st">":  CTRL:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">subs</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Condition</span> <span class="op">==</span> <span class="st">"CTRL"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">x</span> , <span class="st">":  STIM:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">subs</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Condition</span> <span class="op">==</span> <span class="st">"STIM"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#set idents</span>
  <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">subs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">subs</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">Condition</span>
  
  <span class="co">#scale the subsetted data</span>
  <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">subs</span>,assay<span class="op">=</span><span class="st">'CellToCell'</span><span class="op">)</span>
  <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">subs</span>, assay<span class="op">=</span><span class="st">'CellToCell'</span><span class="op">)</span>
  
  <span class="co">#these are the features in the scaledata slot</span>
  <span class="va">feats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">subs</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">CellToCell</span><span class="op">@</span><span class="va">scale.data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">feats</span>
  
  <span class="co">#find markers (here we use wilcox, but ROC and other tests can be used as well)</span>
  <span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindAllMarkers.html">FindAllMarkers</a></span><span class="op">(</span><span class="va">subs</span>, features<span class="op">=</span><span class="va">feats</span>, test.use <span class="op">=</span> <span class="st">"wilcox"</span>,assay<span class="op">=</span><span class="st">'CellToCell'</span><span class="op">)</span>
  
  <span class="co">#subset to top 10 markers per condition</span>
  <span class="va">top10</span> <span class="op">&lt;-</span> <span class="va">markers</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, wt <span class="op">=</span> <span class="va">avg_log2FC</span><span class="op">)</span>
  
  <span class="co">#Make a heatmap</span>
  <span class="fu"><a href="https://satijalab.org/seurat/reference/DoHeatmap.html">DoHeatmap</a></span><span class="op">(</span><span class="va">subs</span>,group.by<span class="op">=</span><span class="st">"ident"</span>,features<span class="op">=</span><span class="va">top10</span><span class="op">$</span><span class="va">gene</span>, assay<span class="op">=</span><span class="st">"CellToCell"</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Top DE Mechanisms, CTRL vs STIM: "</span>,<span class="va">x</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; [1] "CD14 Mono—DC:  CTRL:216"</span>
<span class="co">#&gt; [1] "CD14 Mono—DC:  STIM:191"</span>
<span class="co">#&gt; [[1]]</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>These results confirm our expectation that chemokine signaling for this cell-cell VectorType is upregulated in the STIM condition as compared to contol. We can further isolate this specific VectorType for embedding or clustering:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Perform visualization for VectorTypes of interest</span>
<span class="va">VOI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CD14 Mono—DC"</span><span class="op">)</span>
<span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">scc.sub</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">scc.sub</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">VectorType</span>
<span class="va">voi.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">scc.sub</span>,idents <span class="op">=</span> <span class="va">VOI</span><span class="op">)</span>
<span class="va">voi.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">voi.data</span><span class="op">)</span>
<span class="va">voi.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">voi.data</span><span class="op">)</span>
<span class="va">voi.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">voi.data</span>,npcs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">voi.data</span>,ndim<span class="op">=</span><span class="fl">50</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">voi.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">voi.data</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">voi.data</span>,group.by <span class="op">=</span> <span class="st">'VectorType'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">voi.data</span>,group.by <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-10-3.png" width="700"></p>
<p>And we can then check that the markers we found earlier appear accurate:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">voi.data</span>,
            features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'CCL2—CCR1'</span>,<span class="st">'CCL2—CCR5'</span><span class="op">)</span>,max.cutoff <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://satijalab.org/seurat/reference/VlnPlot.html">VlnPlot</a></span><span class="op">(</span><span class="va">voi.data</span>,
            features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'CCL2—CCR1'</span>,<span class="st">'CCL2—CCR5'</span><span class="op">)</span>,log <span class="op">=</span> <span class="cn">T</span>,group.by <span class="op">=</span> <span class="st">'Condition'</span><span class="op">)</span></code></pre></div>
<p><img src="04%20Differential%20CellToCell_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Micha Sam Brickman Raredon, Junchen Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
