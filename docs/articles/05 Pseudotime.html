<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pseudtotemporal Ordering with NICHES • NICHES</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pseudtotemporal Ordering with NICHES">
<meta property="og:description" content="NICHES">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NICHES</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01%20NICHES%20Spatial.html">Estimating Microenvironment from Spatial Data</a>
    </li>
    <li>
      <a href="../articles/02%20NICHES%20Single.html">Converting Single-Cell Atlases to Single-Cell Signaling Atlases</a>
    </li>
    <li>
      <a href="../articles/03%20Rat%20Alveolus.html">Exploring Cellular Relationships in the Rat Alveolus</a>
    </li>
    <li>
      <a href="../articles/04%20NICHES%20Differential%20By%20Vectortype.html">Using NICHES to Analyze Cell-Cell Signaling Across Conditions</a>
    </li>
    <li>
      <a href="../articles/05%20Pseudotime.html">Pseudtotemporal Ordering with NICHES</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Pseudtotemporal Ordering with NICHES</h1>
                        <h4 class="author">Micha Sam Brickman Raredon &amp; Neeharika Kothapalli</h4>
            
            <h4 class="date">2022-06-17</h4>
      
      
      <div class="hidden name"><code>05 Pseudotime.Rmd</code></div>

    </div>

    
    
<p>NICHES data can be overlayed onto pseudotemporal orderings. However, the exact way in which this is done matters a great deal for biologically interpretability. This vignette demonstrates one of the simplest and most mangeable use-cases: asking how sensed microenvironment ‘changes’ with differentiation in a single homeostatic tissue. The ligand milieu in this case is constant (since we are dealing with a single system and the tissue itself has constant composition) but the receptor profile of a differentiating lineage will change over psuedotime. NICHES allows rapid observation of this changing interaction.</p>
<p>We leverage data from <a href="https://www.science.org/doi/10.1126/sciadv.aaw3851" class="uri">https://www.science.org/doi/10.1126/sciadv.aaw3851</a> to show this specific application.</p>
<div id="load-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://msraredon.github.io/NICHES/">NICHES</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">monocle3</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap">ComplexHeatmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SeuratWrappers</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/">magick</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>We look at the whole dataset as a starting point (10,953 cells):</p>
</div>
<div id="load-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"raredon_2019_rat.Robj"</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">TSNEPlot</a></span><span class="op">(</span><span class="va">rat</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We are going to focus specifically on ATII-ATI epithelial differentiation. We want to ask what changes occur in the sensed microenviornment as ATII cells differentate into ATI cells. For simplicity, we are going to again limit our analysis to 9 celltypes that we are confident are often found in close proximity to both ATII and ATI cells in the alveolus of the lung:</p>
<div id="focus-on-histologically-co-localized-cell-system-and-downsample-for-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#focus-on-histologically-co-localized-cell-system-and-downsample-for-this-vignette" class="anchor"></a>Focus on histologically co-localized cell-system, and downsample for this vignette</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">rat</span>,idents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ATII'</span>,<span class="st">'ATI'</span>,
                                 <span class="st">'Mac_alv'</span>,<span class="st">'Mac_inter'</span>,
                                 <span class="st">'Fib_Col13a1+'</span>,<span class="st">'Fib_Col14a1+'</span>,<span class="st">'SMCs'</span>,
                                 <span class="st">'EC_cap'</span>,<span class="st">'EC_vasc'</span><span class="op">)</span><span class="op">)</span>
<span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">rat.sub</span>,cells <span class="op">=</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/WhichCells.html">WhichCells</a></span><span class="op">(</span><span class="va">rat.sub</span>,downsample <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">)</span>
<span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">rat.sub</span><span class="op">)</span>
<span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">rat.sub</span><span class="op">)</span>
<span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">rat.sub</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">rat.sub</span>,ndims<span class="op">=</span><span class="fl">50</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rat.sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">rat.sub</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">UMAPPlot</a></span><span class="op">(</span><span class="va">rat.sub</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>We then compute SystemToCell information within this cell-system and isolate the outputs corresponding to our two transdifferentiating celltypes, as follows:</p>
</div>
<div id="visualization-of-homeostatic-microenvironment-for-two-transdifferentiatng-celltypes" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-of-homeostatic-microenvironment-for-two-transdifferentiatng-celltypes" class="anchor"></a>Visualization of homeostatic microenvironment for two transdifferentiatng celltypes</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lung.niche</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunNICHES.html">RunNICHES</a></span><span class="op">(</span><span class="va">rat.sub</span>,
                        assay <span class="op">=</span> <span class="st">'alra'</span>,
                        species <span class="op">=</span> <span class="st">'rat'</span>,
                        LR.database <span class="op">=</span> <span class="st">'fantom5'</span>,
                        SystemToCell <span class="op">=</span> <span class="cn">T</span>,
                        CellToCell <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> 
<span class="co"># Here we use a previously-created imputed data slot. The same computation may be performed on any data slot including standard log-normalized RNA values.</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="va">lung.niche</span><span class="op">$</span><span class="va">SystemToCell</span> <span class="co">#Extract the output of interest</span>

<span class="co"># Subset to receiving cells of interest</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/Idents.html">Idents</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">niche.object</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">ReceivingType</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">niche.object</span>,idents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ATII'</span>,<span class="st">'ATI'</span><span class="op">)</span><span class="op">)</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="co">#Scale</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">)</span> <span class="co">#Identify variable features</span>
<span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">niche.object</span>,npcs <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="co">#RunPCA</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">niche.object</span>,ndims<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co">#Choose PCs to use for embedding</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">niche.object</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span> <span class="co">#Embed</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span><span class="va">niche.object</span>,reduction <span class="op">=</span> <span class="st">'umap'</span>,label <span class="op">=</span> <span class="cn">T</span>,repel <span class="op">=</span> <span class="cn">F</span>,label.size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoLegend</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html">NoAxes</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Alveolar Epithelial Microenvironment'</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>This is a good start and tells us we are on the right track. We can that some SystemToCell measurements classified as landing on an ATII are actually quantitatively similar to those landing on ATI cells. We can explore this in greater depth by pausing the analysis of the NICHES data, and taking the time to pseudotemporally order the original cells. Here, we use monocle3 to do this:</p>
</div>
<div id="psuedotemporal-ordering-of-original-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#psuedotemporal-ordering-of-original-cells" class="anchor"></a>Psuedotemporal ordering of original cells</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Subset, run UMAP, take a look to check</span>
<span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">rat.sub</span>,idents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'ATII'</span>,<span class="st">'ATI'</span><span class="op">)</span><span class="op">)</span>
<span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">cell.data</span><span class="op">)</span>
<span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">cell.data</span><span class="op">)</span>
<span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">cell.data</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html">ElbowPlot</a></span><span class="op">(</span><span class="va">cell.data</span>,ndims<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span><span class="va">cell.data</span>,dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">UMAPPlot</a></span><span class="op">(</span><span class="va">cell.data</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co"># Convert to Monocle CDS</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">cell.cds &lt;-<span class="st"> </span><span class="kw">as.cell_data_set</span>(cell.data)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co"># Calculate size factors using built-in function in monocle3</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#cell.cds &lt;- estimate_size_factors(cell.cds)</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co"># Make pseudotime trajectory with a known start point</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">cell.cds &lt;-<span class="st"> </span><span class="kw">cluster_cells</span>(<span class="dt">cds =</span> cell.cds, <span class="dt">reduction_method =</span> <span class="st">"UMAP"</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">cell.cds &lt;-<span class="st"> </span><span class="kw">learn_graph</span>(cell.cds, <span class="dt">use_partition =</span> F)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="er">|</span><span class="st">                                                                      </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">  <span class="op">|</span><span class="st">                                                                            </span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">start &lt;-<span class="st"> </span><span class="kw">WhichCells</span>(cell.data,<span class="dt">idents =</span> <span class="st">'ATII'</span>)</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">cell.cds &lt;-<span class="st"> </span><span class="kw">order_cells</span>(cell.cds, <span class="dt">reduction_method =</span> <span class="st">"UMAP"</span>, <span class="dt">root_cells =</span> start)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17"></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co"># Plot pseudotime trajectory</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="kw">plot_cells</span>(</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">  <span class="dt">cds =</span> cell.cds,</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">  <span class="dt">color_cells_by =</span> <span class="st">"pseudotime"</span>,</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">  <span class="dt">show_trajectory_graph =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb9-23" data-line-number="23">  <span class="dt">cell_size =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-5-3.png" width="700"></p>
<p>We can then map this pseudotemporal ordering back to the original Seurat object:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cell.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/AddMetaData.html">AddMetaData</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">cell.data</span>,
  metadata <span class="op">=</span> <span class="va">cell.cds</span><span class="op">@</span><span class="va">principal_graph_aux</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">UMAP</span><span class="op">$</span><span class="va">pseudotime</span>,
  col.name <span class="op">=</span> <span class="st">"Pseudotime"</span>
<span class="op">)</span>

<span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">cell.data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pseudotime"</span><span class="op">)</span>, pt.size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>OR, we can map the pseudotemporal ordering on the NICHES SystemToCell object.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">niche.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/AddMetaData.html">AddMetaData</a></span><span class="op">(</span>
  object <span class="op">=</span> <span class="va">niche.object</span>,
  metadata <span class="op">=</span> <span class="va">cell.cds</span><span class="op">@</span><span class="va">principal_graph_aux</span><span class="op">@</span><span class="va">listData</span><span class="op">$</span><span class="va">UMAP</span><span class="op">$</span><span class="va">pseudotime</span>,
  col.name <span class="op">=</span> <span class="st">"Pseudotime"</span>
<span class="op">)</span>

<span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html">FeaturePlot</a></span><span class="op">(</span><span class="va">niche.object</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Pseudotime"</span><span class="op">)</span>, pt.size <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>But more fundamentally, we are now set to see how signaling ‘changes’ over pseudotime, which was our original goal. Here is one approach for how to do this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert NICHES object to matrix format</span>
<span class="va">data</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">niche.object</span><span class="op">@</span><span class="va">assays</span><span class="op">[[</span><span class="st">"SystemToCell"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">)</span>

<span class="co"># Count the percent of non-zeros for each mechanism</span>
<span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">data</span>,<span class="fl">1</span>,<span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">temp</span><span class="op">&gt;</span><span class="fl">0.25</span><span class="op">)</span><span class="op">]</span> <span class="co"># Remove mechanisms with more than 75% of zeros</span>
<span class="va">mechs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">mechs</span>,<span class="op">]</span> <span class="co"># 836 mechs</span>

<span class="co"># Pull metadata</span>
<span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">niche.object</span><span class="op">@</span><span class="va">meta.data</span>
<span class="va">meta</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span>

<span class="co"># Run Pearson correlation for each mechanism against pseudotime</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">mechs</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"data"</span>
  <span class="va">temp</span><span class="op">$</span><span class="va">cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">temp</span>,<span class="va">meta</span>,by<span class="op">=</span><span class="st">"cell"</span><span class="op">)</span>
  <span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">temp</span><span class="op">$</span><span class="va">Pseudotime</span>,<span class="va">temp</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>
  <span class="va">row</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>mech <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,p.val <span class="op">=</span> <span class="va">test</span><span class="op">[[</span><span class="st">"p.value"</span><span class="op">]</span><span class="op">]</span>, cor <span class="op">=</span> <span class="va">test</span><span class="op">[[</span><span class="st">"estimate"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"cor"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">row</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Subset to mechanisms with desired thresholds</span>
<span class="va">df</span><span class="op">$</span><span class="va">q.val</span><span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">p.val</span>, method <span class="op">=</span> <span class="st">"fdr"</span><span class="op">)</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">q.val</span><span class="op">&lt;</span><span class="fl">0.05</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">mech</span> <span class="op">%in%</span> <span class="va">mechs</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">plot</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">plot</span><span class="op">$</span><span class="va">cor</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">.8</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Looking for high correlations with pseudotime</span>
<span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="va">plot</span><span class="op">$</span><span class="va">mech</span>,<span class="op">]</span><span class="op">)</span>

<span class="co"># Arrange metadata and cells by pseudotime</span>
<span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Pseudotime</span><span class="op">)</span>
<span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="va">to_plot</span><span class="op">[</span>,<span class="va">meta</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span>

<span class="co"># Prepare Annotations</span>
<span class="va">ha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">meta</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Pseudotime'</span>,<span class="st">'ReceivingType'</span><span class="op">)</span><span class="op">]</span>,which <span class="op">=</span> <span class="st">'column'</span><span class="op">)</span>

<span class="co"># Scale for visualization</span>
<span class="va">to_plot_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">)</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># scale data for better visualization</span>

<span class="co"># Plot in HeatMap Form</span>
<span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span><span class="va">to_plot_scale</span>,
        column_order <span class="op">=</span> <span class="va">meta</span><span class="op">$</span><span class="va">cell</span>,
        show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,
        show_row_names <span class="op">=</span> <span class="cn">TRUE</span>,
        top_annotation <span class="op">=</span> <span class="va">ha</span>,
        use_raster <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="05%20Pseudotime_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>The altered sensed-signaling through Fgfr2, Hhip, and Met are all particularly biologically relevant in this instance.</p>
<p>These observed patterns are only dependent on receptor expression, and therefore could have been found through traditional transcriptomic analysis. Because NICHES operates on a mechanism level, however, this approach narrows focus exclusively onto receptors which have cognate ligand being expressed within the system.</p>
<p>It should be noted that NICHES is also a powerful tool for psuedotemporal investigation of processes in which both the ligand milieu and the receptor expression of a differentating lineage are changing. This will be covered in a spearate vignette, since it is a distinct biologic application and is more complicated to implement.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Micha Sam Brickman Raredon, Junchen Yang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
